{% set name = "verilator" %}
{% set version = "5.008" %}
{% set sha256 = "1d19f4cd186eec3dfb363571e3fe2e6d3377386ead6febc6ad45402f0634d2a6" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/{{ name }}/{{ name }}/archive/v{{ version }}.tar.gz
  sha256: {{ sha256 }}
  patches:
      - patches/0001-treat-DEFENV_VERILATOR_ROOT-as-c_str-for-conda-reloc.patch

build:
  number: 2
  skip: true  # [win]
  has_prefix_files:
    - share/verilator/include/verilated.mk
    - share/pkgconfig/verilator.pc

requirements:
  build:
    - {{ compiler('cxx') }}
    - autoconf
    - bison
    - help2man
    - make
    - perl
    - python
    - sed
  host:
    - flex  # need to link against it for target
    - zlib
    - systemc-dev
  run:
    - {{ compiler('cxx') }}  # [osx]
    # there must be a way to derive this from compiler('cxx') but this should work
    - gxx_impl_linux-64  # [linux64]
    - {{ pin_compatible('flex') }}
    - make
    - perl
    - python
  run_constrained:
    - {{ pin_compatible('systemc-dev', exact=True) }}

test:
  requires:
    - make
    - {{ pin_compatible('systemc-dev', exact=True) }}
  source_files:
    - examples/make_hello_c
    - examples/make_hello_sc
  commands:
    - verilator --version
    - make -C examples/make_hello clean default VERILATOR='verilator --debugi 2'
    # we want it to fail if systemc isn't supported, not silently do nothing, hence 'run' target
    - make -C examples/make_hello_sc clean run VERILATOR='verilator --debugi 2'

about:
  home: https://veripool.org/wiki/verilator
  license: LGPL-3.0-only OR Artistic-2.0
  license_file:
    - LICENSE
    - Artistic
  summary: The fastest Verilog HDL simulator

  description: |
    Welcome to Verilator, the fastest Verilog HDL simulator.
      • Accepts synthesizable Verilog or SystemVerilog
      • Performs lint code-quality checks
      • Compiles into multithreaded C++, or SystemC
      • Creates XML to front-end your own tools
    Fast
      • Outperforms many commercial simulators
      • Single- and multi-threaded output models
    Widely Used
      • Wide industry and academic deployment
      • Out-of-the-box support from Arm, and RISC-V vendor IP
    Community Driven & Openly Licensed
      • Guided by the CHIPS Alliance and Linux Foundation
      • Open, and free as in both speech and beer
      • More simulation for your verification budget
    Commercial Support Available
      • Commercial support contracts
      • Design support contracts
      • Enhancement contracts
  doc_url: https://www.veripool.org/projects/verilator/wiki/Documentation
  dev_url: https://github.com/verilator/verilator

extra:
  recipe-maintainers:
    - timkpaine
    - timsnyder
